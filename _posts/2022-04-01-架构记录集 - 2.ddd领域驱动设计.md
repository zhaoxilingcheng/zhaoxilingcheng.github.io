---
layout: post
title: 架构记录集 - 2.ddd领域驱动设计
date: 2022-04-01
categories: java
tags: [java]
description: 无。
---

## 领域驱动设计？

### mvc模式

常见的模式，面向过程开发，行为与数据分离的贫血模式。基于dao开发的模式，重db设计。

开发过程简单，复杂的应用场景扩展度差，后期维护成本高，业务不内聚。

### 领域驱动设计

基于充血模型，各业务进行边界拆分成每一个领域，将对象的行为(业务逻辑)从service中回归到对象上来，且业务与各中间件(db,mq,cache)进行分离进行分离。

前期设计复杂，可维护性强，业务内聚，业务优先，隔离存储。

<br/>

在当前的时候，经常会听到有人争辩单体应用与分布式应用的选择，在这里也会有这样的困惑，领域驱动设计能带来什么样的价值？

一个好的架构设计可以有效的的减缓软件熵带来的复杂度。

[软件熵](https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6%E7%86%B5/22991034?fr=aladdin)

>  是指软件的无序程度。软件熵可用来说明软件在经过不断修改后，无序程度提高的现象。

<br/>

#### 基础知识

1. 实体
2. 值对象
3. 聚合
4. 聚合根
5. 领域服务
6. 应用服务
7. 防腐层

<br/>

#### 防腐层

增加一个适配器，屏蔽外部的各种变化，与外部进行解耦，ex： req、bo、do、dto、query 等装换，使得代码更内聚。

#####  实体与值对象

一个领域对象（聚合）包含了实体和值对象，

实体：有唯一业务标识， 有生命周期。

值对象： 属性相同则相同， 不可变，否则影响其他实体业务。

#### 聚合和聚合根

实体和值对象之间会存在某种关系，通过判断各实体之间的边界，将其组合成一个聚合，实体和值对象强绑定起来，并提供一个唯一聚合根作为入口，选择聚合根的判断： 这个聚合根的生命周期结束，则这个聚合的生命周期结束。

聚合应该和仓储进行对应， 且聚合不应太复杂，太复杂查询与存储性能差，且业务会变得复杂。

#### 领域服务与应用服务

领域服务： 当某个业务，涉及到同一个聚合的两个实例时， 且这个业务感觉不太适合放在聚合中，将此业务放入领域服务中。

应用服务： 将业务进行模块化，协调各领域，执行事务，或者触发后发送mq之类和业务无关的动作。

<br/>

### 架构方法

在领域模型上， 又提出了

[适配器模型（六边形架构）](http://alistair.cockburn.us/Hexagonal+architecture)：业务代码为最核心的内部层，在外层（ui、db、等）增加适配器的模式，更关注业务。

[洋葱架构](https://jeffreypalermo.com/2008/07/the-onion-architecture-part-1/)， 使用依赖倒置原则，从内到外，业务是核心层，外部层依赖内部层，越外层越抽象。并将基础层外部化且编写适配器进行注入。

